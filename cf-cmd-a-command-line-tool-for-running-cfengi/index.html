
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>cf-cmd: A command-line tool for running CFEngine snippets - Blog</title>
  <meta name="author" content="Diego Zamboni">

  
  <meta name="description" content="While writing this book, I&#8217;ve had to run hundreds of little CFEngine snippets to run tests, develop examples, verify functionality, or get a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zzamboni.org/blog.cf-learn.info/cf-cmd-a-command-line-tool-for-running-cfengi">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Blog</a></h1>
  
    <h2>News about "Learning CFEngine 3"</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:zzamboni.org/blog.cf-learn.info" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://cf-learn.info/">The Book</a></li>
  <li><a href="http://cf-learn.info/author.html">The Author</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="http://cf-learn.info/discussion.html">Forum</a></li>
  <li><a href="http://cf-learn.info/code.html">Code</a></li>
  <li><a href="http://oreilly.com/catalog/errata.csp?isbn=0636920022022">Errata</a></li>
  <li><a href="http://cf-learn.info/reviews.html">Reviews</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Cf-cmd: A Command-line Tool for Running CFEngine Snippets</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-27T19:33:00-06:00" pubdate data-updated="true">Dec 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><div><span style="font-size: small;">While writing this book, I&#8217;ve had to run hundreds of little CFEngine snippets to run tests, develop examples, verify functionality, or get a solid idea of what some constructs did. After building the typical &#8220;test bundle&#8221; scaffolding in an editor for the hundredth time, I decided to do something about it. The result is the cf-cmd command. I will let it speak for itself:</span></div>
<p></p>
<blockquote style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 20px; border-left-style: none; font-family: Courier New;">
<div>
<div>
<span style="font-family: Courier New; font-size: x-small;"> </span>
<div><span style="font-size: small;">$ <strong>cf-cmd help</strong></span></div>
<div><span style="font-size: small;">cf-cmd v1.0 - Diego Zamboni diego@zzamboni.org&gt;</span></div>
<p></p>
<div><span style="font-size: small;">cf-cmd is a tool that allows you to run small CFEngine snippets quickly,</span></div>
<div><span style="font-size: small;">by automatically wrapping them around a standard &#8220;test&#8221; bundle.</span></div>
<p></p>
<div><span style="font-size: small;">The CFEngine Standard Library is automatically included.</span></div>
<p></p>
<div><span style="font-size: small;">The following inputs are understood by this tool:</span></div>
<p></p>
<div><span style="font-size: small;">help     Print this message</span></div>
<div><span style="font-size: small;">list     Print current policy</span></div>
<div><span style="font-size: small;">clear    Clear current policy</span></div>
<div><span style="font-size: small;">go|run   Execute current policy using cf-agent</span></div>
<div><span style="font-size: small;">type:    Switch to the given promise type</span></div>
<div><span style="font-size: small;">         (classes:, commands:, databases:, environments:, files:, interfaces:,</span></div>
<div><span style="font-size: small;">         methods:, outputs:, packages:, processes:, reports:, services:,</span></div>
<div><span style="font-size: small;">         storage:, vars:)</span></div>
<div><span style="font-size: small;">           The current promise type is shown in the prompt.</span></div>
<p></p>
<div><span style="font-size: small;">All other lines are added literally to the current promise type.</span></div>
<p></p>
<div><span style="font-size: small;">Commands can be abbreviated to any part of their name (for example,</span></div>
<div><span style="font-size: small;">&#8220;r&#8221; or &#8220;ru&#8221; for &#8220;run&#8221;).</span></div>
<p></p>
<div><span style="font-size: small;">You can add lines to any of the standard promise types inside the test</span></div>
<div><span style="font-size: small;">bundle by switching to the appropriate promise type first.</span></div>
<p></p>
<div><span style="font-size: small;">The default promise type is &#8220;reports:&#8221;, to make it easier to quickly print</span></div>
<div><span style="font-size: small;">the value of expressions.</span></div>
<p></p>
<div><span style="font-size: small;">You can give the inputs also on the command line, they are interpreted</span></div>
<div><span style="font-size: small;">in exactly the same way (make sure to quote things correctly).</span></div>
<p></p>
<div><span style="font-size: small;">Examples:</span></div>
<div><span style="font-size: small;">  cf-cmd &#8216;&#8220;Flavor: $(sys.flavor)&#8221;;&#8217; list run</span></div>
<div><span style="font-size: small;">  cf-cmd &#8216;&#8220;var1 = $(var1)&#8221;;&#8217; vars: &#8216;&#8220;var1&#8221; string =&gt; &#8220;test&#8221;;&#8217; l r</span></div>
<div><span style="font-size: small;">  cf-cmd h</span></div>
</div>
</div>
</blockquote>
<p></p>
<div><span style="font-size: small;">You should try out those examples at the end to see what they do. An example interactive session looks like this (I have bolded the inputs to make them easier to see):</span></div>
<p></p>
<div>
<span style="font-size: 12px;"> </span>
<div>
<blockquote style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 20px; border-left-style: none;">
<div style="font-family: Courier New;"><span style="font-size: small;">$ cf-cmd </span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>&#8220;this is a test&#8221;;</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>list</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">body common control {</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   inputs =&gt; { &#8220;/var/cfengine/inputs/cfengine_stdlib.cf&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   bundlesequence =&gt; { &#8220;test&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<p></p>
<div style="font-family: Courier New;"><span style="font-size: small;">bundle agent test</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">{</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports:</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">cfengine::</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">  &#8220;this is a test&#8221;;</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>run</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">-&gt; Running policy with &#8216;cf-agent -KI -f ./test.cf&#8217;</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">R: this is a test</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>clear</strong></span></div>
<div><span style="font-size: small;"><span style="font-family: Courier New;">reports: &gt; </span><strong style="font-family: Courier New;">l    </strong><em>(abbreviation of &#8220;list&#8221;)</em></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">body common control {</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   inputs =&gt; { &#8220;/var/cfengine/inputs/cfengine_stdlib.cf&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   bundlesequence =&gt; { &#8220;test&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<p></p>
<div style="font-family: Courier New;"><span style="font-size: small;">bundle agent test</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">{</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>files: </strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">-&gt; Switching to files: promise type.</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">files: &gt; <strong>&#8220;/tmp/test&#8221;</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">files: &gt; <strong>  create =&gt; &#8220;true&#8221;,</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">files: &gt; <strong>  classes =&gt; if_repaired(&#8220;done&#8221;);</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">files: &gt; <strong>reports: </strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">-&gt; Switching to reports: promise type.</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>done::</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>&#8220;Success&#8221;;</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>l</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">body common control {</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   inputs =&gt; { &#8220;/var/cfengine/inputs/cfengine_stdlib.cf&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">   bundlesequence =&gt; { &#8220;test&#8221; };</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<p></p>
<div style="font-family: Courier New;"><span style="font-size: small;">bundle agent test</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">{</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">files:</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">  &#8220;/tmp/test&#8221;</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">    create =&gt; &#8220;true&#8221;,</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">    classes =&gt; if_repaired(&#8220;done&#8221;);</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports:</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">  done::</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">  &#8220;Success&#8221;;</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">}</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; <strong>run</strong></span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">-&gt; Running policy with &#8216;cf-agent -KI -f ./test.cf&#8217;</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;"> -&gt; Created file /tmp/test, mode = 600</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">R: Success</span></div>
<div style="font-family: Courier New;"><span style="font-size: small;">reports: &gt; </span></div>
</blockquote>
</div>
<p></p>
<div>The interactive prompt supports editing and completion of all commands and promise types - press Tab to view available completions.</div>
<p></p>
<div>You can download the script <div><script src='https://gist.github.com/1525722.js'></script>
<noscript><pre><code></code></pre></noscript></div>
.</div>
<p></p>
<div>Just put it somewhere in your path. If needed, modify the location of the <a href="http://cfengine.com/manuals/cfengine_stdlib.cf">cfengine_stdlib.cf</a> file on your system (by default it looks for it under /var/cfengine/inputs/). You need Ruby installed (I tested with version 1.9.3).</div>
<p></p>
<div>If you find it useful, or if you find any problems or have any suggestions, please let me know. I&#8217;d be happy to hear from you.</div>
</div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Diego Zamboni</span></span>

      








  


<time datetime="2011-12-27T19:33:00-06:00" pubdate data-updated="true">Dec 27<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/categories/cfengine/'>cfengine</a>, <a class='category' href='/categories/testing/'>testing</a>, <a class='category' href='/categories/tools/'>tools</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://zzamboni.org/blog.cf-learn.info/cf-cmd-a-command-line-tool-for-running-cfengi" data-via="" data-counturl="http://zzamboni.org/blog.cf-learn.info/cf-cmd-a-command-line-tool-for-running-cfengi" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/migrating-from-cfengine-2-to-cfengine-3" title="Previous Post: Migrating from CFEngine 2 to CFEngine 3">&laquo; Migrating from CFEngine 2 to CFEngine 3</a>
      
      
        <a class="basic-alignment right" href="/cfengine-3-training-on-january-25-27th-2012" title="Next Post: CFEngine 3 training on January 25-27th, 2012">CFEngine 3 training on January 25-27th, 2012 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/cfengine-documentation-index-updated/">CFEngine documentation index updated</a>
      </li>
    
      <li class="post">
        <a href="/blog-moving/">Blog moving</a>
      </li>
    
      <li class="post">
        <a href="/learning-cfengine-3-at-lisa12">"Learning CFEngine 3" at LISA'12</a>
      </li>
    
      <li class="post">
        <a href="/second-release-of-learning-cfengine-3">Second release of "Learning CFEngine 3"</a>
      </li>
    
      <li class="post">
        <a href="/cfengine-tip-004-how-to-bootstrap-a-cfengine">CFEngine tip #004: How to bootstrap a CFEngine client</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Diego Zamboni -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
